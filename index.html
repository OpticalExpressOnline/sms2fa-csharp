<!DOCTYPE html><html><head><title>SMS Two-Factor Authentication with Twilio</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="SMS Two-Factor Authentication with Twilio"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">SMS Two-Factor Authentication with Twilio</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn to implement SMS two-factor authentication in your web app with Twilio. 2FA helps further secure your users' data by validating more than just a password. This tutorial will show you the code to make it happen.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="How it Works" data-file="SMS2FA.Web/App_Start/IdentityConfig.cs" class="step"><h2 id="about-this-application">About this Application</h2>
<p>This <a href="http://www.asp.net/mvc">ASP.NET</a> application example
demonstrates how to implement an SMS two-factor authentication using Twilio.</p>
<p><em>To run this application yourself <a href="https://github.com/TwilioDevEd/sms2fa-csharp">download the code and follow the
instructions on GitHub</a>.</em></p>
<p>Adding two-factor authentication (2FA) to your web application increases the
security of your user&#39;s data. <a href="http://en.wikipedia.org/wiki/Multi-factor_authentication">Multi-factor
authentication</a>
determines the identity of a user in two steps: </p>
<ol>
<li><p>First we validate the user with an email and password</p>
</li>
<li><p>Second, we validate using a mobile device, by sending them a one-time <strong>verification code</strong>.</p>
</li>
</ol>
<p>Once our user enters the verification code, we know they have received the SMS, and indeed are who they say they are. This is a standard SMS implementation.</p>
<p>For a slightly more advanced implementation using <a href="https://www.twilio.com/authy">Authy</a> One-Touch checkout this <a href="//www.twilio.com/docs/tutorials/walkthrough/two-factor-authentication/python/flask">tutorial</a>.</p>
<p>Let&#39;s get started!</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/rest/sending-messages">REST API: Sending SMS or MMS</a></li>
</ul>
</div><div data-title="Adding Two-Factor Authentication" data-file="SMS2FA.Web/App_Start/IdentityConfig.cs" data-highlight="28-31,38-47" class="step"><h2 id="adding-two-factor-authentication">Adding Two-Factor Authentication</h2>
<p>This application uses <a href="//www.asp.net/identity/overview/getting-started/introduction-to-aspnet-identity">ASP.NET
Identity</a>
to manage authentication.</p>
<p>The Twilio helper library allows us to easily send an SMS.</p>
<p>First we have to create an instance of a <strong>Twilio Rest Client</strong> with our
credentials. Now all we have to do to send an SMS using the REST API is to call <code>client.messages.create()</code> with the necessary parameters.</p>
<p>You can find your credentials at your <a href="//www.twilio.com/user/account/phone-numbers/incoming">Twilio Account</a>.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/libraries/csharp">Twilio C# Helper Library</a></li>
<li><a href="//www.twilio.com/docs/quickstart/python/sms/sending-via-rest">Twilio: Sending a Text Message</a></li>
</ul>
</div><div data-title="Registering a Two-Factor Provider" data-file="SMS2FA.Web/App_Start/IdentityConfig.cs" data-highlight="85-88,95" class="step"><h2 id="registering-a-two-factor-provider">Registering a Two-Factor Provider</h2>
<p>We use <code>manager</code>, which is an instance of the <code>ApplicationUserManager</code> to
register the <code>PhoneNumberTokenProvider</code> to send text messages.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//msdn.microsoft.com/en-us/library/dn613285.aspx">PhoneNumberTokenProvider</a></li>
</ul>
</div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="SMS2FA.Web/App_Start/IdentityConfig.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uU2VjdXJpdHkuQ2xhaW1zOwp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOwp1c2luZyBNaWNyb3NvZnQuQXNwTmV0LklkZW50aXR5Owp1c2luZyBNaWNyb3NvZnQuQXNwTmV0LklkZW50aXR5LkVudGl0eUZyYW1ld29yazsKdXNpbmcgTWljcm9zb2Z0LkFzcE5ldC5JZGVudGl0eS5Pd2luOwp1c2luZyBNaWNyb3NvZnQuT3dpbjsKdXNpbmcgTWljcm9zb2Z0Lk93aW4uU2VjdXJpdHk7CnVzaW5nIFNNUzJGQS5XZWIuTW9kZWxzOwp1c2luZyBUd2lsaW87CnVzaW5nIFdhcm1UcmFuc2Zlci5XZWIuRG9tYWluOwoKbmFtZXNwYWNlIFNNUzJGQS5XZWIKewogICAgcHVibGljIGNsYXNzIEVtYWlsU2VydmljZSA6IElJZGVudGl0eU1lc3NhZ2VTZXJ2aWNlCiAgICB7CiAgICAgICAgcHVibGljIFRhc2sgU2VuZEFzeW5jKElkZW50aXR5TWVzc2FnZSBtZXNzYWdlKQogICAgICAgIHsKICAgICAgICAgICAgLy8gUGx1ZyBpbiB5b3VyIGVtYWlsIHNlcnZpY2UgaGVyZSB0byBzZW5kIGFuIGVtYWlsLgogICAgICAgICAgICByZXR1cm4gVGFzay5Gcm9tUmVzdWx0KDApOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgY2xhc3MgU21zU2VydmljZSA6IElJZGVudGl0eU1lc3NhZ2VTZXJ2aWNlCiAgICB7CiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBUd2lsaW9SZXN0Q2xpZW50IF9jbGllbnQ7CgogICAgICAgIHB1YmxpYyBTbXNTZXJ2aWNlKCkKICAgICAgICB7CiAgICAgICAgICAgIF9jbGllbnQgPSBuZXcgVHdpbGlvUmVzdENsaWVudChDb25maWcuQWNjb3VudFNJRCwgQ29uZmlnLkF1dGhUb2tlbik7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU21zU2VydmljZShUd2lsaW9SZXN0Q2xpZW50IGNsaWVudCkKICAgICAgICB7CiAgICAgICAgICAgIF9jbGllbnQgPSBjbGllbnQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgVGFzayBTZW5kQXN5bmMoSWRlbnRpdHlNZXNzYWdlIG1lc3NhZ2UpCiAgICAgICAgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gX2NsaWVudC5TZW5kTWVzc2FnZSgKICAgICAgICAgICAgICAgIENvbmZpZy5Ud2lsaW9OdW1iZXIsCiAgICAgICAgICAgICAgICBtZXNzYWdlLkRlc3RpbmF0aW9uLAogICAgICAgICAgICAgICAgbWVzc2FnZS5Cb2R5CiAgICAgICAgICAgICk7CgogICAgICAgICAgICByZXR1cm4gVGFzay5Gcm9tUmVzdWx0KDApOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBDb25maWd1cmUgdGhlIGFwcGxpY2F0aW9uIHVzZXIgbWFuYWdlciB1c2VkIGluIHRoaXMgYXBwbGljYXRpb24uIFVzZXJNYW5hZ2VyIGlzIGRlZmluZWQgaW4gQVNQLk5FVCBJZGVudGl0eSBhbmQgaXMgdXNlZCBieSB0aGUgYXBwbGljYXRpb24uCiAgICBwdWJsaWMgY2xhc3MgQXBwbGljYXRpb25Vc2VyTWFuYWdlciA6IFVzZXJNYW5hZ2VyPEFwcGxpY2F0aW9uVXNlcj4KICAgIHsKICAgICAgICBwdWJsaWMgQXBwbGljYXRpb25Vc2VyTWFuYWdlcihJVXNlclN0b3JlPEFwcGxpY2F0aW9uVXNlcj4gc3RvcmUpCiAgICAgICAgICAgIDogYmFzZShzdG9yZSkKICAgICAgICB7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIEFwcGxpY2F0aW9uVXNlck1hbmFnZXIgQ3JlYXRlKElkZW50aXR5RmFjdG9yeU9wdGlvbnM8QXBwbGljYXRpb25Vc2VyTWFuYWdlcj4gb3B0aW9ucywgSU93aW5Db250ZXh0IGNvbnRleHQpIAogICAgICAgIHsKICAgICAgICAgICAgdmFyIG1hbmFnZXIgPSBuZXcgQXBwbGljYXRpb25Vc2VyTWFuYWdlcihuZXcgVXNlclN0b3JlPEFwcGxpY2F0aW9uVXNlcj4oY29udGV4dC5HZXQ8QXBwbGljYXRpb25EYkNvbnRleHQ+KCkpKTsKICAgICAgICAgICAgLy8gQ29uZmlndXJlIHZhbGlkYXRpb24gbG9naWMgZm9yIHVzZXJuYW1lcwogICAgICAgICAgICBtYW5hZ2VyLlVzZXJWYWxpZGF0b3IgPSBuZXcgVXNlclZhbGlkYXRvcjxBcHBsaWNhdGlvblVzZXI+KG1hbmFnZXIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIEFsbG93T25seUFscGhhbnVtZXJpY1VzZXJOYW1lcyA9IGZhbHNlLAogICAgICAgICAgICAgICAgUmVxdWlyZVVuaXF1ZUVtYWlsID0gdHJ1ZQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gQ29uZmlndXJlIHZhbGlkYXRpb24gbG9naWMgZm9yIHBhc3N3b3JkcwogICAgICAgICAgICBtYW5hZ2VyLlBhc3N3b3JkVmFsaWRhdG9yID0gbmV3IFBhc3N3b3JkVmFsaWRhdG9yCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFJlcXVpcmVkTGVuZ3RoID0gNiwKICAgICAgICAgICAgICAgIFJlcXVpcmVOb25MZXR0ZXJPckRpZ2l0ID0gdHJ1ZSwKICAgICAgICAgICAgICAgIFJlcXVpcmVEaWdpdCA9IHRydWUsCiAgICAgICAgICAgICAgICBSZXF1aXJlTG93ZXJjYXNlID0gdHJ1ZSwKICAgICAgICAgICAgICAgIFJlcXVpcmVVcHBlcmNhc2UgPSB0cnVlLAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gQ29uZmlndXJlIHVzZXIgbG9ja291dCBkZWZhdWx0cwogICAgICAgICAgICBtYW5hZ2VyLlVzZXJMb2Nrb3V0RW5hYmxlZEJ5RGVmYXVsdCA9IHRydWU7CiAgICAgICAgICAgIG1hbmFnZXIuRGVmYXVsdEFjY291bnRMb2Nrb3V0VGltZVNwYW4gPSBUaW1lU3Bhbi5Gcm9tTWludXRlcyg1KTsKICAgICAgICAgICAgbWFuYWdlci5NYXhGYWlsZWRBY2Nlc3NBdHRlbXB0c0JlZm9yZUxvY2tvdXQgPSA1OwoKICAgICAgICAgICAgLy8gUmVnaXN0ZXIgdHdvIGZhY3RvciBhdXRoZW50aWNhdGlvbiBwcm92aWRlcnMuIFRoaXMgYXBwbGljYXRpb24gdXNlcyBQaG9uZSBhbmQgRW1haWxzIGFzIGEgc3RlcCBvZiByZWNlaXZpbmcgYSBjb2RlIGZvciB2ZXJpZnlpbmcgdGhlIHVzZXIKICAgICAgICAgICAgLy8gWW91IGNhbiB3cml0ZSB5b3VyIG93biBwcm92aWRlciBhbmQgcGx1ZyBpdCBpbiBoZXJlLgogICAgICAgICAgICBtYW5hZ2VyLlJlZ2lzdGVyVHdvRmFjdG9yUHJvdmlkZXIoIlBob25lIENvZGUiLCBuZXcgUGhvbmVOdW1iZXJUb2tlblByb3ZpZGVyPEFwcGxpY2F0aW9uVXNlcj4KICAgICAgICAgICAgewogICAgICAgICAgICAgICAgTWVzc2FnZUZvcm1hdCA9ICJZb3VyIHNlY3VyaXR5IGNvZGUgaXMgezB9IgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbWFuYWdlci5SZWdpc3RlclR3b0ZhY3RvclByb3ZpZGVyKCJFbWFpbCBDb2RlIiwgbmV3IEVtYWlsVG9rZW5Qcm92aWRlcjxBcHBsaWNhdGlvblVzZXI+CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFN1YmplY3QgPSAiU2VjdXJpdHkgQ29kZSIsCiAgICAgICAgICAgICAgICBCb2R5Rm9ybWF0ID0gIllvdXIgc2VjdXJpdHkgY29kZSBpcyB7MH0iCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBtYW5hZ2VyLkVtYWlsU2VydmljZSA9IG5ldyBFbWFpbFNlcnZpY2UoKTsKICAgICAgICAgICAgbWFuYWdlci5TbXNTZXJ2aWNlID0gbmV3IFNtc1NlcnZpY2UoKTsKICAgICAgICAgICAgdmFyIGRhdGFQcm90ZWN0aW9uUHJvdmlkZXIgPSBvcHRpb25zLkRhdGFQcm90ZWN0aW9uUHJvdmlkZXI7CiAgICAgICAgICAgIGlmIChkYXRhUHJvdGVjdGlvblByb3ZpZGVyICE9IG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG1hbmFnZXIuVXNlclRva2VuUHJvdmlkZXIgPSAKICAgICAgICAgICAgICAgICAgICBuZXcgRGF0YVByb3RlY3RvclRva2VuUHJvdmlkZXI8QXBwbGljYXRpb25Vc2VyPihkYXRhUHJvdGVjdGlvblByb3ZpZGVyLkNyZWF0ZSgiQVNQLk5FVCBJZGVudGl0eSIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbWFuYWdlcjsKICAgICAgICB9CiAgICB9CgogICAgLy8gQ29uZmlndXJlIHRoZSBhcHBsaWNhdGlvbiBzaWduLWluIG1hbmFnZXIgd2hpY2ggaXMgdXNlZCBpbiB0aGlzIGFwcGxpY2F0aW9uLgogICAgcHVibGljIGNsYXNzIEFwcGxpY2F0aW9uU2lnbkluTWFuYWdlciA6IFNpZ25Jbk1hbmFnZXI8QXBwbGljYXRpb25Vc2VyLCBzdHJpbmc+CiAgICB7CiAgICAgICAgcHVibGljIEFwcGxpY2F0aW9uU2lnbkluTWFuYWdlcihBcHBsaWNhdGlvblVzZXJNYW5hZ2VyIHVzZXJNYW5hZ2VyLCBJQXV0aGVudGljYXRpb25NYW5hZ2VyIGF1dGhlbnRpY2F0aW9uTWFuYWdlcikKICAgICAgICAgICAgOiBiYXNlKHVzZXJNYW5hZ2VyLCBhdXRoZW50aWNhdGlvbk1hbmFnZXIpCiAgICAgICAgewogICAgICAgIH0KCiAgICAgICAgcHVibGljIG92ZXJyaWRlIFRhc2s8Q2xhaW1zSWRlbnRpdHk+IENyZWF0ZVVzZXJJZGVudGl0eUFzeW5jKEFwcGxpY2F0aW9uVXNlciB1c2VyKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIHVzZXIuR2VuZXJhdGVVc2VySWRlbnRpdHlBc3luYygoQXBwbGljYXRpb25Vc2VyTWFuYWdlcilVc2VyTWFuYWdlcik7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIEFwcGxpY2F0aW9uU2lnbkluTWFuYWdlciBDcmVhdGUoSWRlbnRpdHlGYWN0b3J5T3B0aW9uczxBcHBsaWNhdGlvblNpZ25Jbk1hbmFnZXI+IG9wdGlvbnMsIElPd2luQ29udGV4dCBjb250ZXh0KQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBBcHBsaWNhdGlvblNpZ25Jbk1hbmFnZXIoY29udGV4dC5HZXRVc2VyTWFuYWdlcjxBcHBsaWNhdGlvblVzZXJNYW5hZ2VyPigpLCBjb250ZXh0LkF1dGhlbnRpY2F0aW9uKTsKICAgICAgICB9CiAgICB9Cn0K</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/sms2fa-csharp" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>